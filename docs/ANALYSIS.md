# –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏: –ú–∞—Å—Å–æ–≤–æ–µ —Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ DataMatrix –∏–∑ PDF

## –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç

**–î–∞, —ç—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ä–µ–∞–ª—å–Ω–æ.** –ó–∞–¥–∞—á–∞ —Ç–∏–ø–æ–≤–∞—è –∏ —Ö–æ—Ä–æ—à–æ —Ä–µ—à–∞–µ—Ç—Å—è. –ù–∏–∂–µ ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
PDF —Ñ–∞–π–ª—ã
    ‚îÇ
    ‚ñº
[1. PDF ‚Üí –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]     (pdf2image / PyMuPDF)
    ‚îÇ
    ‚ñº
[2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞]         (OpenCV ‚Äî –∫–æ–Ω—Ç—Ä–∞—Å—Ç, –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è, –ø–æ–≤–æ—Ä–æ—Ç)
    ‚îÇ
    ‚ñº
[3. –î–µ—Ç–µ–∫—Ü–∏—è DataMatrix]   (pylibdmtx / pyzbar)
    ‚îÇ
    ‚ñº
[4. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ]         (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∫–æ–¥–∞)
    ‚îÇ
    ‚ñº
[5. –ó–∞–ø–∏—Å—å –≤ Excel]        (openpyxl / pandas)
```

---

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### Python + –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```
pdf2image          ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF ‚Üí PNG/JPEG
  (–∏–ª–∏ PyMuPDF)
Pillow             ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
OpenCV             ‚Äî –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (–µ—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø–ª–æ—Ö–æ–µ)
pylibdmtx          ‚Äî –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ DataMatrix
pandas + openpyxl  ‚Äî –∑–∞–ø–∏—Å—å –≤ Excel
tqdm               ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è 40000 —Ñ–∞–π–ª–æ–≤
multiprocessing    ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
```

### –°–∏—Å—Ç–µ–º–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
- **libdmtx** ‚Äî C-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pylibdmtx
- **poppler** ‚Äî –¥–ª—è pdf2image (—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ PDF)

---

## –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–∫–æ–Ω—Ü–µ–ø—Ç)

```python
import os
import pandas as pd
from pdf2image import convert_from_path
from pylibdmtx.pylibdmtx import decode
from tqdm import tqdm
from concurrent.futures import ProcessPoolExecutor
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


def process_single_pdf(pdf_path: str) -> list[dict]:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ PDF —Ñ–∞–π–ª–∞."""
    results = []

    try:
        # 1. PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
        pages = convert_from_path(pdf_path, dpi=300)

        for page_num, page_image in enumerate(pages, start=1):
            # 2. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ DataMatrix
            decoded = decode(page_image)

            if decoded:
                for code in decoded:
                    results.append({
                        "file": os.path.basename(pdf_path),
                        "page": page_num,
                        "datamatrix": code.data.decode("utf-8"),
                        "status": "OK"
                    })
            else:
                results.append({
                    "file": os.path.basename(pdf_path),
                    "page": page_num,
                    "datamatrix": None,
                    "status": "NOT_FOUND"
                })

    except Exception as e:
        results.append({
            "file": os.path.basename(pdf_path),
            "page": None,
            "datamatrix": None,
            "status": f"ERROR: {str(e)}"
        })

    return results


def process_all_pdfs(input_folder: str, output_excel: str, max_workers: int = 4):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö PDF –∏–∑ –ø–∞–ø–∫–∏."""

    # –°–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
    pdf_files = [
        os.path.join(input_folder, f)
        for f in os.listdir(input_folder)
        if f.lower().endswith(".pdf")
    ]

    logger.info(f"–ù–∞–π–¥–µ–Ω–æ PDF —Ñ–∞–π–ª–æ–≤: {len(pdf_files)}")

    all_results = []

    # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    with ProcessPoolExecutor(max_workers=max_workers) as executor:
        futures = {executor.submit(process_single_pdf, pdf): pdf for pdf in pdf_files}

        for future in tqdm(futures, desc="–û–±—Ä–∞–±–æ—Ç–∫–∞ PDF", total=len(pdf_files)):
            result = future.result()
            all_results.extend(result)

    # –ó–∞–ø–∏—Å—å –≤ Excel
    df = pd.DataFrame(all_results)
    df.to_excel(output_excel, index=False, engine="openpyxl")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    ok_count = df[df["status"] == "OK"].shape[0]
    fail_count = df[df["status"] != "OK"].shape[0]
    logger.info(f"–£—Å–ø–µ—à–Ω–æ: {ok_count}, –û—à–∏–±–æ–∫: {fail_count}")
    logger.info(f"–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_excel}")


if __name__ == "__main__":
    process_all_pdfs(
        input_folder="./pdf_files",
        output_excel="./datamatrix_results.xlsx",
        max_workers=6  # –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥ CPU
    )
```

---

## –ö–ª—é—á–µ–≤—ã–µ –Ω—é–∞–Ω—Å—ã –∏ —Ä–∏—Å–∫–∏

### üü¢ –ß—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ö–æ—Ä–æ—à–æ:
- –ß—ë—Ç–∫–∏–µ, –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DataMatrix (–Ω–µ —Ñ–æ—Ç–æ)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤
- PDF —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –∏–ª–∏ –≤—ã—Å–æ–∫–∏–º DPI

### üü° –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –ö–æ–¥ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è | –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ OpenCV: –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ |
| –ö–æ–¥ –ø–æ–≤—ë—Ä–Ω—É—Ç/–ø–æ–¥ —É–≥–ª–æ–º | pylibdmtx —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç—É—Ä–æ–≤ |
| –ù–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ PDF | –£–≤–µ–ª–∏—á–∏—Ç—å DPI –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (300‚Üí600) |
| –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞ 40000 —Ñ–∞–π–ª–æ–≤ | –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è (multiprocessing), –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DPI |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–¥–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ | pylibdmtx –Ω–∞–π–¥—ë—Ç –≤—Å–µ, decode() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ |

### üî¥ –ß—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å —É –∑–∞–∫–∞–∑—á–∏–∫–∞:
1. **–û–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–∏–Ω –∫–æ–¥** –∏–ª–∏ **–æ–¥–∏–Ω —Ñ–∞–π–ª = –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü**?
2. **–ö–æ–¥—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ** –∏–ª–∏ —ç—Ç–æ **—Å–∫–∞–Ω—ã/—Ñ–æ—Ç–æ**?
3. **–ö–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –∫–æ–¥–∞?** (–ß–µ—Å—Ç–Ω—ã–π –∑–Ω–∞–∫ ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–æ GTIN + —Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä + –∫—Ä–∏–ø—Ç–æ—Ö–≤–æ—Å—Ç)
4. **–ù—É–∂–Ω–æ –ª–∏ –ø–∞—Ä—Å–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–¥–∞** –Ω–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —á–∞—Å—Ç–∏ (GTIN, serial, crypto)?
5. **–ï—Å—Ç—å –ª–∏ –ø—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?

---

## –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```
1 —Ñ–∞–π–ª (1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞, 300 DPI):
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF ‚Üí Image: ~0.3-1 —Å–µ–∫
  - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ DataMatrix: ~0.1-0.5 —Å–µ–∫
  - –ò—Ç–æ–≥–æ: ~0.5-1.5 —Å–µ–∫ –Ω–∞ —Ñ–∞–π–ª

40000 —Ñ–∞–π–ª–æ–≤:
  - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: ~11-17 —á–∞—Å–æ–≤
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (8 —è–¥–µ—Ä): ~1.5-2 —á–∞—Å–∞
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (16 —è–¥–µ—Ä): ~45-60 –º–∏–Ω—É—Ç
```

---

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ –∫–æ–¥—ã ‚Äî –ß–µ—Å—Ç–Ω—ã–π –ó–Ω–∞–∫)

```python
def parse_honest_mark(raw_code: str) -> dict:
    """–ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –ß–µ—Å—Ç–Ω—ã–π –ó–Ω–∞–∫."""
    # –¢–∏–ø–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 01 + GTIN(14) + 21 + Serial(13) + 91 + Key(4) + 92 + Crypto(44)
    result = {}

    if "01" in raw_code:
        idx = raw_code.index("01")
        result["gtin"] = raw_code[idx+2:idx+16]

    if "21" in raw_code:
        idx = raw_code.index("21")
        # Serial –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è (GS = \x1d) –∏–ª–∏ AI
        serial_start = idx + 2
        result["serial"] = raw_code[serial_start:serial_start+13]

    if "91" in raw_code:
        idx = raw_code.index("91")
        result["verification_key"] = raw_code[idx+2:idx+6]

    if "92" in raw_code:
        idx = raw_code.index("92")
        result["crypto"] = raw_code[idx+2:]

    return result
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —ç—Ç–∞–ø–∞–º

```
–≠—Ç–∞–ø 1 (1-2 –¥–Ω—è):   –ü–æ–ª—É—á–∏—Ç—å 5-10 –ø—Ä–∏–º–µ—Ä–æ–≤ PDF, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
–≠—Ç–∞–ø 2 (1-2 –¥–Ω—è):   –ù–∞–ø–∏—Å–∞—Ç—å —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
–≠—Ç–∞–ø 3 (0.5 –¥–Ω—è):   –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞)
–≠—Ç–∞–ø 4 (0.5 –¥–Ω—è):   –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ, –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ –ß–ó
–≠—Ç–∞–ø 5 (–ø–æ –∂–µ–ª–∞–Ω–∏—é): GUI / –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞
```

**–ò—Ç–æ–≥–æ: 3-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π** –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

---

## –í—ã–≤–æ–¥

–ó–∞–¥–∞—á–∞ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è**, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **–∑—Ä–µ–ª—ã–µ**, –≥–ª–∞–≤–Ω—ã–π —Ä–∏—Å–∫ ‚Äî **–∫–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö PDF**. –ü–æ–ø—Ä–æ—Å–∏ —É –∑–∞–∫–∞–∑—á–∏–∫–∞ 5-10 –ø—Ä–∏–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤ ‚Äî –∑–∞ –ø–∞—Ä—É —á–∞—Å–æ–≤ —Å—Ç–∞–Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ, –Ω—É–∂–Ω–∞ –ª–∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ –≤—Å—ë —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.